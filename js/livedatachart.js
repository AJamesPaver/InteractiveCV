// LIVE DATA CHART
function rand() {
    return Math.random();
}

window.addEventListener('DOMContentLoaded', function() {
    // We need to wait for the html to be loaded first, otherwise we can't find the elements
    
    const vCar = [86.571,86.745,86.913,87.073,87.228,87.377,87.52,87.658,87.79,87.918,88.041,88.159,88.273,88.382,88.488,88.59,88.688,88.782,88.873,88.96,89.045,89.126,89.204,89.28,89.352,89.422,89.49,89.555,89.618,89.678,89.737,89.793,89.847,89.899,89.95,89.998,90.045,90.091,90.134,90.176,90.217,90.256,90.294,90.33,90.365,90.399,90.432,90.463,90.494,90.523,90.551,90.579,90.605,90.63,90.655,90.679,90.701,90.723,90.745,90.765,90.785,90.804,88.478,88.478,88.478,88.478,88.478,88.478,88.478,86.151,69.557,54.744,46.898,38.421,38.421,35.067,35.067,35.067,36.222,38.527,41.984,46.435,49.92,52.812,55.291,51.692,45.917,45.917,45.917,46.445,48.319,51.226,53.923,56.261,58.322,60.165,61.829,63.342,64.728,66.004,67.183,68.277,64.709,58.747,56.109,53.863,52.856,52.856,52.856,52.856,53.242,53.802,54.581,55.698,57.262,59.214,60.969,62.559,64.01,65.342,66.57,67.708,68.766,69.751,70.672,71.535,72.344,73.105,73.821,74.497,75.135,75.738,76.309,76.85,77.362,77.849,78.311,78.75,79.168,79.566,79.944,80.305,80.648,80.976,81.289,81.587,81.872,82.144,82.404,82.653,82.89,83.118,83.335,83.543,83.742,83.933,84.115,84.29,84.457,84.618,84.771,77.732,61.654,52.284,47.215,39.906,39.906,35.693,35.693,34.137,34.137,34.137,34.137,35.069,36.043,37.347,38.817,40.301,41.8,43.294,44.796,46.394,48.186,50.255,52.697,55.191,57.375,59.316,61.06,62.642,64.086,65.412,66.635,67.769,68.822,69.804,70.721,71.581,72.387,73.145,73.86,74.533,75.169,75.202,60.223,47.573,41.338,31.618,31.618,26.531,26.531,25.393,25.393,25.393,27.226,28.366,30.822,33.698,37.119,41.165,45.75,49.366,52.345,54.887,57.106,59.076,60.843,62.445,63.905,65.246,66.482,67.626,68.689,69.68,70.605,71.472,72.285,73.049,73.769,74.448,75.088,75.694,76.267,76.81,77.325,77.813,78.277,78.718,79.137,70.606,57.222,48.903,43.398,39.678,37.298,36.145,36.145,36.145,37.747,40.229,43.782,47.809,51.046,53.77,56.126,58.203,60.058,61.731,63.253,64.647,65.929,67.113,68.213,69.235,70.19,71.083,71.92,72.706,73.445,74.142,74.8,75.421,76.009,76.566,77.093,77.593,78.068,78.519,78.948,77.324,71.849,70.902,70.902,70.902,71.638,72.441,73.196,73.907,74.578,75.212,75.811,76.378,76.915,77.424,77.908,78.367,78.803,79.218,79.614,79.99,80.348,80.69,81.016,77.53,71.914,71.914,71.914,72.691,73.432,74.13,74.788,75.41,75.998,76.555,77.083,77.584,78.059,78.511,78.941,79.349,79.738,80.108,80.461,80.797,81.118,81.424,81.717,81.996,82.262,82.517,82.761,82.994,83.216,83.43,83.634,83.829,84.016,84.195,84.366,84.53,84.687,84.838,84.983,79.05,61.077,50.232,43.996,35.116,35.116,29.781,29.781,27.976,27.976,27.976,28.17,29.488,30.601,32.372,34.287,36.336,38.434,40.549,42.721,45.069,47.663,50.648,53.43,55.829,57.939,59.821,61.517,63.058,64.467,65.763,66.96,65.895,54.559,48.202,40.112,40.112,34.596,34.596,31.381,31.381,30.046,30.046,30.046,30.062,31.212,32.048,33.695,35.435,37.456,39.753,42.374,45.442,49.067,52.093,54.669,56.915,58.905,60.689,62.305,63.777,65.128,66.373,67.525,68.595,69.592,70.523,71.395,72.213,69.147,64.266,59.673,59.673,59.673,59.673,60.628,62.248,63.726,65.081,66.329,67.485,68.558,69.557,70.491,71.364,72.184,72.954,73.68,74.363,75.009,75.619,76.196,76.742,77.261,77.752,78.219,78.327,74.04,72.186,67.982,67.982,65.689,65.689,65.689,65.689,65.957,66.849,67.967,69.006,69.976,70.882,71.732,72.529,73.279,73.985,74.652,75.281,75.877,76.44,77.062,77.653,78.214,78.748,79.257,79.742,80.204,80.645,81.065,81.467,81.852,82.219,82.571,82.907,83.229,83.538,83.833,84.117,84.388,84.649,84.899,85.139,85.369,85.59,85.802,86.006,86.202,86.39];
    const sLap = [0,9.4114,18.823,28.234,37.646,47.057,56.468,65.88,75.291,84.702,94.114,103.53,112.94,122.35,131.76,141.17,150.58,159.99,169.4,178.82,188.23,197.64,207.05,216.46,225.87,235.28,244.7,254.11,263.52,272.93,282.34,291.75,301.16,310.58,319.99,329.4,338.81,348.22,357.63,367.04,376.46,385.87,395.28,404.69,414.1,423.51,432.92,442.33,451.75,461.16,470.57,479.98,489.39,498.8,508.21,517.63,527.04,536.45,545.86,555.27,564.68,574.09,583.51,592.92,602.33,611.74,621.15,630.56,639.97,649.39,658.8,668.21,677.62,687.03,696.44,705.85,715.26,724.68,734.09,743.5,752.91,762.32,771.73,781.14,790.56,799.97,809.38,818.79,828.2,837.61,847.02,856.44,865.85,875.26,884.67,894.08,903.49,912.9,922.32,931.73,941.14,950.55,959.96,969.37,978.78,988.2,997.61,1007,1016.4,1025.8,1035.3,1044.7,1054.1,1063.5,1072.9,1082.3,1091.7,1101.1,1110.5,1120,1129.4,1138.8,1148.2,1157.6,1167,1176.4,1185.8,1195.2,1204.7,1214.1,1223.5,1232.9,1242.3,1251.7,1261.1,1270.5,1279.9,1289.4,1298.8,1308.2,1317.6,1327,1336.4,1345.8,1355.2,1364.7,1374.1,1383.5,1392.9,1402.3,1411.7,1421.1,1430.5,1439.9,1449.4,1458.8,1468.2,1477.6,1487,1496.4,1505.8,1515.2,1524.6,1534.1,1543.5,1552.9,1562.3,1571.7,1581.1,1590.5,1599.9,1609.3,1618.8,1628.2,1637.6,1647,1656.4,1665.8,1675.2,1684.6,1694,1703.5,1712.9,1722.3,1731.7,1741.1,1750.5,1759.9,1769.3,1778.8,1788.2,1797.6,1807,1816.4,1825.8,1835.2,1844.6,1854,1863.5,1872.9,1882.3,1891.7,1901.1,1910.5,1919.9,1929.3,1938.7,1948.2,1957.6,1967,1976.4,1985.8,1995.2,2004.6,2014,2023.4,2032.9,2042.3,2051.7,2061.1,2070.5,2079.9,2089.3,2098.7,2108.1,2117.6,2127,2136.4,2145.8,2155.2,2164.6,2174,2183.4,2192.9,2202.3,2211.7,2221.1,2230.5,2239.9,2249.3,2258.7,2268.1,2277.6,2287,2296.4,2305.8,2315.2,2324.6,2334,2343.4,2352.8,2362.3,2371.7,2381.1,2390.5,2399.9,2409.3,2418.7,2428.1,2437.5,2447,2456.4,2465.8,2475.2,2484.6,2494,2503.4,2512.8,2522.3,2531.7,2541.1,2550.5,2559.9,2569.3,2578.7,2588.1,2597.5,2607,2616.4,2625.8,2635.2,2644.6,2654,2663.4,2672.8,2682.2,2691.7,2701.1,2710.5,2719.9,2729.3,2738.7,2748.1,2757.5,2766.9,2776.4,2785.8,2795.2,2804.6,2814,2823.4,2832.8,2842.2,2851.6,2861.1,2870.5,2879.9,2889.3,2898.7,2908.1,2917.5,2926.9,2936.4,2945.8,2955.2,2964.6,2974,2983.4,2992.8,3002.2,3011.6,3021.1,3030.5,3039.9,3049.3,3058.7,3068.1,3077.5,3086.9,3096.3,3105.8,3115.2,3124.6,3134,3143.4,3152.8,3162.2,3171.6,3181,3190.5,3199.9,3209.3,3218.7,3228.1,3237.5,3246.9,3256.3,3265.7,3275.2,3284.6,3294,3303.4,3312.8,3322.2,3331.6,3341,3350.5,3359.9,3369.3,3378.7,3388.1,3397.5,3406.9,3416.3,3425.7,3435.2,3444.6,3454,3463.4,3472.8,3482.2,3491.6,3501,3510.4,3519.9,3529.3,3538.7,3548.1,3557.5,3566.9,3576.3,3585.7,3595.1,3604.6,3614,3623.4,3632.8,3642.2,3651.6,3661,3670.4,3679.9,3689.3,3698.7,3708.1,3717.5,3726.9,3736.3,3745.7,3755.1,3764.6,3774,3783.4,3792.8,3802.2,3811.6,3821,3830.4,3839.8,3849.3,3858.7,3868.1,3877.5,3886.9,3896.3,3905.7,3915.1,3924.5,3934,3943.4,3952.8,3962.2,3971.6,3981,3990.4,3999.8,4009.2,4018.7,4028.1,4037.5,4046.9,4056.3,4065.7,4075.1,4084.5,4094,4103.4,4112.8,4122.2,4131.6,4141,4150.4,4159.8,4169.2,4178.7,4188.1,4197.5,4206.9,4216.3,4225.7,4235.1,4244.5,4253.9,4263.4,4272.8,4282.2,4291.6,4301,4310.4,4319.8,4329.2,4338.6,4348.1,4357.5,4366.9,4376.3,4385.7,4395.1,4404.5,4413.9,4423.3,4432.8,4442.2,4451.6,4461,4470.4,4479.8,4489.2,4498.6,4508.1,4517.5,4526.9,4536.3,4545.7,4555.1,4564.5,4573.9,4583.3,4592.8,4602.2,4611.6,4621,4630.4,4639.8,4649.2,4658.6,4668,4677.5,4686.9,4696.3];
    const cCorner = [-2.4912e-15,-6.5386e-15,-1.1574e-14,-1.6641e-14,-1.9258e-14,-1.5295e-14,9.2511e-16,3.58e-14,9.4502e-14,1.7759e-13,2.7588e-13,3.5712e-13,3.4816e-13,1.4983e-13,-3.5986e-13,-1.2925e-12,-2.6884e-12,-4.423e-12,-6.0846e-12,-6.8363e-12,-5.2841e-12,1.5414e-12,1.5738e-11,3.8806e-11,6.9678e-11,1.0243e-10,1.2366e-10,1.1028e-10,2.8678e-11,-1.6316e-10,-5.1921e-10,-1.0556e-09,-1.6876e-09,-2.2178e-09,-2.268e-09,-1.2595e-09,1.548e-09,6.9217e-09,1.5375e-08,2.6698e-08,3.8536e-08,4.4609e-08,3.5129e-08,-3.287e-09,-8.5442e-08,-2.2255e-07,-4.1366e-07,-6.3321e-07,-8.1507e-07,-8.1285e-07,-3.5345e-07,8.3615e-07,3.0077e-06,6.245e-06,1.0056e-05,1.372e-05,1.5302e-05,1.1064e-05,-3.3945e-06,-3.6019e-05,-8.9498e-05,-0.0001609,-0.00023599,-0.0002831,-0.00024759,-5.1943e-05,0.00039988,0.0012003,0.0024275,0.0040722,0.0060144,0.0081251,0.010241,0.012187,0.013856,0.01505,0.015457,0.015019,0.013551,0.011141,0.0079711,0.0039121,-9.1107e-05,-0.003813,-0.006922,-0.0093383,-0.010845,-0.011464,-0.0113,-0.01052,-0.009252,-0.0077337,-0.0059915,-0.0041175,-0.0019808,-0.00028422,0.0015353,0.0028932,0.0040668,0.0051991,0.0062745,0.0072588,0.0081562,0.008909,0.0095063,0.0098418,0.010061,0.010094,0.010049,0.0099672,0.009861,0.0097083,0.0094702,0.0091131,0.0087022,0.008331,0.0080695,0.0079389,0.0078825,0.0078254,0.0076701,0.0074251,0.0070511,0.0066506,0.0061517,0.0056794,0.0052362,0.004821,0.0044595,0.0041608,0.0039165,0.0037272,0.0035848,0.0034506,0.0033291,0.0031778,0.0030004,0.0027509,0.002401,0.001994,0.001543,0.0010112,0.00057638,0.00026422,6.7159e-05,-3.545e-05,-7.4355e-05,-7.9247e-05,-7.3219e-05,-7.2865e-05,-8.6925e-05,-0.00011617,-0.00015031,-0.00016012,-0.00010401,7.1236e-05,0.00042396,0.0010082,0.0018642,0.0030051,0.0044028,0.0059773,0.0076106,0.0091575,0.010692,0.012065,0.013274,0.014304,0.015124,0.015703,0.015986,0.015966,0.015661,0.015112,0.014425,0.013706,0.013078,0.012512,0.012013,0.01156,0.011096,0.010587,0.010013,0.0093421,0.0085555,0.0076767,0.0066185,0.0055424,0.004498,0.0035532,0.0027346,0.0020448,0.0014749,0.0010158,0.00066147,0.00040321,0.00022077,5.3408e-05,-0.00018273,-0.00056523,-0.001164,-0.0020421,-0.0032531,-0.0048324,-0.0067944,-0.0091314,-0.011908,-0.014734,-0.01766,-0.020372,-0.02261,-0.023948,-0.02415,-0.02317,-0.021322,-0.018923,-0.016202,-0.013458,-0.010679,-0.0081728,-0.00587,-0.0038563,-0.0022574,-0.0010871,-0.00034847,1.9e-05,8.1758e-05,-9.8261e-05,-0.00047234,-0.00097038,-0.0015003,-0.0019899,-0.0023467,-0.0025398,-0.0025889,-0.0025328,-0.0024259,-0.0023201,-0.0022594,-0.0022655,-0.002329,-0.0024187,-0.002512,-0.0026185,-0.0027869,-0.0030753,-0.0035471,-0.0042684,-0.0052798,-0.0065857,-0.008131,-0.0098075,-0.011496,-0.012984,-0.014151,-0.014827,-0.014891,-0.014181,-0.012686,-0.010403,-0.0075595,-0.0045777,-0.0016665,0.00094703,0.0028641,0.0040877,0.004759,0.0049622,0.0048333,0.0045151,0.0040951,0.0036068,0.0030717,0.0025062,0.0019059,0.0012998,0.00076094,0.00034838,0.00015261,0.0002048,0.00050669,0.0010904,0.001821,0.0026204,0.003473,0.0043627,0.0052245,0.0060532,0.0068385,0.0074982,0.0079588,0.0082031,0.0082218,0.0080137,0.0076246,0.0070934,0.0064401,0.0056895,0.0048807,0.0040627,0.0032881,0.002598,0.002023,0.0016498,0.0014485,0.0014605,0.0016886,0.0021501,0.0028201,0.0036559,0.0046137,0.0056037,0.0065918,0.0073715,0.0079469,0.0081564,0.0079384,0.007261,0.0060927,0.0044623,0.0025144,0.00034307,-0.0018081,-0.0037124,-0.0051745,-0.0060465,-0.0063139,-0.0059992,-0.0052631,-0.0042771,-0.0031789,-0.0021411,-0.0012678,-0.00059335,-0.0001532,6.5853e-05,0.00013875,0.00012514,8.2959e-05,5.6151e-05,7.1383e-05,0.00015025,0.00029819,0.00049684,0.00070596,0.0008643,0.00089694,0.00074121,0.00034775,-0.00034815,-0.0012926,-0.0025063,-0.0039059,-0.005459,-0.0072102,-0.0091472,-0.011196,-0.013316,-0.01543,-0.017433,-0.019154,-0.020311,-0.02093,-0.020863,-0.020165,-0.018998,-0.017573,-0.016128,-0.014808,-0.01369,-0.012755,-0.011923,-0.011089,-0.010247,-0.0092929,-0.008274,-0.0071978,-0.0060857,-0.0049352,-0.0036663,-0.0022242,-0.00062988,0.0011061,0.0030197,0.0048846,0.0068196,0.0086128,0.010287,0.011774,0.013197,0.014508,0.015716,0.016842,0.017835,0.018565,0.018925,0.01889,0.018465,0.017686,0.016573,0.015419,0.014208,0.012996,0.011765,0.010426,0.0089347,0.0072942,0.0055829,0.0040052,0.0026678,0.0017321,0.0012358,0.0011617,0.0014525,0.0020093,0.0026815,0.0033877,0.0041142,0.0048718,0.0056663,0.0064338,0.007186,0.0079242,0.0085079,0.0089457,0.0091863,0.0091836,0.0088971,0.0083334,0.0075227,0.0065406,0.0055119,0.0044875,0.0034473,0.0024378,0.001566,0.00083759,0.00032161,8.2821e-05,0.00015506,0.0005532,0.001253,0.002186,0.0032504,0.0043346,0.0053379,0.0061854,0.0068532,0.0073327,0.0076598,0.0079006,0.0080996,0.0082746,0.0084273,0.0085422,0.0086083,0.0085985,0.0085039,0.0083282,0.0080501,0.007662,0.0071534,0.0064851,0.0056695,0.0047802,0.003773,0.0027856,0.0018645,0.0011301,0.000582,0.00021055,-5.9824e-06,-0.00010394,-0.00012477,-0.00010512,-7.1488e-05,-4.0531e-05,-1.7699e-05,-3.3704e-06,3.9535e-06,6.4339e-06,6.1129e-06,4.5624e-06,2.7932e-06,1.3311e-06,3.9425e-07,-1.1042e-07,-3.1287e-07,-3.4481e-07,-2.8344e-07,-1.9106e-07,-1.0491e-07,-4.1193e-08,-2.4966e-09,1.4644e-08,1.893e-08,1.6824e-08,1.2193e-08,8.131e-09,4.9097e-09]
    var arrayLength = 100
    var Channel1    = []
    var Channel2    = []
    var iPoint      = 101
    var N           = vCar.length

    for(var i = 0; i < arrayLength; i++) {
        Channel1[i] = vCar[i]
        Channel2[i] = cCorner[i]
    }

    var trace1 = {
        name: 'Channel 1',
        y: Channel1,
        mode: 'lines',
        line: {
          color: '#00FFFF',
          shape: 'spline'
        }
    }

    var trace2 = {
        name: 'Channel 2',
        y: Channel2,
        xaxis: 'x2',
        yaxis: 'y2',
        mode: 'lines',
        line: {
            color: '#d72323',
            shape: 'spline'
        }
      };
      
    var layout = {
        plot_bgcolor: "#3a4750",
        paper_bgcolor:"#3a4750",
        font: {
            color: "white"
        },
        xaxis: {
            domain: [0, 1],
            showticklabels: false,
        },
        yaxis: {
            domain: [0.52,1],
            gridcolor: "white"
        },
        xaxis2: {
            anchor: 'y2', 
            domain: [0, 1],
        },
        yaxis2: {
            anchor: 'x2', 
            domain: [0, 0.48],
            gridcolor: "white"
        },  
    }

    var data = [trace1, trace2]; 

    Plotly.plot('live-data-plot', data, layout);

    var interval = setInterval(function() {
    
        Channel1 = Channel1.concat(vCar[iPoint])
        Channel1.splice(0, 1)
        Channel2 = Channel2.concat(cCorner[iPoint])
        Channel2.splice(0, 1)
        
        var data_update = {
            y: [Channel1]
        };
        
        Plotly.update('live-data-plot', data_update, {}, [0])

        var data_update = {
            y: [Channel2]
        };
        
        Plotly.update('live-data-plot', data_update, {}, [1])

        iPoint = iPoint + 1
        if (iPoint > N){
            iPoint = 1
        }
    }, 500);

});
